{% schema %}
{
  "name": "custom-obras-populares",
  "tag": "section",
  "settings": [
    {
      "type": "collection",
      "id": "coleccion_obras",
      "label": "Colección de obras"
    }
  ],
  "presets": [
    {
      "name": "Tabla de obras populares"
    }
  ]
}
{% endschema %}

<section class="obras-populares">
  <h2>OBRAS POPULARES</h2>
  <table id="tabla-obras-populares">
    <thead>
      <tr>
        <th onclick="ordenarTabla(0)">↑ TÍTULO</th>
        <th>ARTISTA</th>
        <th onclick="ordenarTabla(2)">PRECIO</th>
      </tr>
    </thead>
    <tbody>
      {% assign productos_populares = section.settings.coleccion_obras.products %}
      {% for producto in productos_populares %}
        <tr 
          class="fila-producto"
          onclick="window.location='{{ producto.url }}'"
          onmouseover="mostrarTooltip('{{ producto.featured_image | image_url: width: 600 }}')"
          onmouseout="ocultarTooltip()"
          style="cursor: pointer;"
        >
          <td data-label="TÍTULO">{{ producto.title }}</td>
          <td data-label="ARTISTA">{{ producto.vendor }}</td>
          <td data-label="PRECIO">
            {% if producto.compare_at_price > producto.price %}
              <span class="precio-anterior">${{ producto.compare_at_price | money_without_currency }} MXN</span>
              <span class="precio-descuento">${{ producto.price | money_without_currency }} MXN</span>
            {% else %}
              DESDE ${{ producto.price | money_without_currency }} MXN
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Tooltip centrado -->
  <div id="tooltip-imagen-producto">
    <img id="tooltip-img" src="" alt="Vista previa" />
  </div>
</section>

<style>
  .obras-populares {
    background: #f3f2eb;
    padding: 2rem 0;
    font-family: 'Helvetica Neue', sans-serif;
  }

  .obras-populares h2 {
    font-size: 28px;
    margin-bottom: 1.5rem;
    margin-left: 1rem;
    text-align: start;
    color: #333;
  }

  #tabla-obras-populares {
    width: 100%;
    border-collapse: collapse;
    background-color: transparent;
  }

  #tabla-obras-populares th,
  #tabla-obras-populares td {
    padding: 1rem;
    text-align: left;
    border-bottom: 2px solid #000;
  }

  #tabla-obras-populares th {
    font-weight: bold;
    font-size: 2rem;
    color: #333;
    cursor: pointer;
    user-select: none;
  }

  #tabla-obras-populares td {
    font-size: 2rem;
    color: #444;
  }

  .precio-anterior {
    text-decoration: line-through;
    color: #999;
    margin-right: 0.5rem;
  }

  .precio-descuento {
    color: #c92064;
    font-weight: 600;
  }

  /* Tooltip centrado */
  #tooltip-imagen-producto {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 9999;
    pointer-events: none;
    display: none;
    padding: 10px;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 6px;
    box-shadow: 0px 2px 12px rgba(0, 0, 0, 0.15);
    justify-content: center;
    align-items: center;
  }

  #tooltip-imagen-producto img {
    max-width: 400px;
    height: auto;
    display: block;
  }

  table, td, th {
    border: 0px solid var(--border-color);
    vertical-align: middle;
}

  @media (max-width: 768px) {
    #tabla-obras-populares,
    #tabla-obras-populares thead,
    #tabla-obras-populares tbody,
    #tabla-obras-populares th,
    #tabla-obras-populares td,
    #tabla-obras-populares tr {
      display: block;
      width: 100%;
    }

    #tabla-obras-populares thead {
      display: none;
    }

    #tabla-obras-populares tr {
      
    }

    #tabla-obras-populares td {
      text-align: right;
      padding-left: 50%;
      position: relative;
    }

    #tabla-obras-populares td::before {
      content: attr(data-label);
      position: absolute;
      left: 1rem;
      top: 1rem;
      font-weight: bold;
      text-align: left;
      color: #555;
    }
  }
</style>

<script>
function ordenarTabla(indiceColumna) {
  const tabla = document.getElementById("tabla-obras-populares");
  let filas = Array.from(tabla.rows).slice(1);
  const ordenAsc = tabla.getAttribute("data-orden") !== "asc";
  filas.sort((a, b) => {
    const textoA = a.cells[indiceColumna].textContent.trim();
    const textoB = b.cells[indiceColumna].textContent.trim();
    if (!isNaN(parseFloat(textoA)) && !isNaN(parseFloat(textoB))) {
      return ordenAsc ? textoA - textoB : textoB - textoA;
    }
    return ordenAsc
      ? textoA.localeCompare(textoB)
      : textoB.localeCompare(textoA);
  });
  tabla.setAttribute("data-orden", ordenAsc ? "asc" : "desc");
  filas.forEach(fila => tabla.appendChild(fila));
}

function mostrarTooltip(imagenUrl) {
  const tooltip = document.getElementById('tooltip-imagen-producto');
  const img = document.getElementById('tooltip-img');
  img.src = imagenUrl;
  tooltip.style.display = 'flex';
}

function ocultarTooltip() {
  const tooltip = document.getElementById('tooltip-imagen-producto');
  tooltip.style.display = 'none';
}
</script>
