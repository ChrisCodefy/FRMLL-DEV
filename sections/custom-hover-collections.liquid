{% schema %}
{
  "name": "Hover Collections",
  "settings": [
    {
      "type": "header",
      "content": "Colecciones con nombre personalizado y hover"
    }
  ],
  "blocks": [
    {
      "type": "collection_item",
      "name": "Colección personalizada",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Seleccionar colección"
        },
        {
          "type": "text",
          "id": "custom_name",
          "label": "Nombre que se muestra",
          "default": "Mi colección"
        },
        {
          "type": "image_picker",
          "id": "hover_image",
          "label": "Imagen para hover"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Hover Collections Avanzado",
      "category": "Custom"
    }
  ]
}
{% endschema %}

{% stylesheet %}
<style>
  .collection-list {
    font-size: 3.5vw;
    font-weight: 700;
    flex-wrap: wrap;
    display: flex;
    gap: 10px;
    line-height: 1.2;
    position: relative;
    flex-direction: row;
    flex-wrap: wrap;
  }

  .collection-item {
    color: black;
    text-decoration: none;
    cursor: pointer;
    position: relative;
    white-space: nowrap;
  }

  .collection-item:hover {
    color: deeppink;
  }

  .collection-image-preview {
    position: absolute;
    top: 50px;
    left: 50%;
    transform: translateX(-50%);
    display: none;
    z-index: 10;
    pointer-events: none;
  }

  .collection-image-preview img {
    max-width: 300px;
    border: 2px solid #000;
    background: white;
  }
</style>
{% endstylesheet %}

<div class="collection-list">
  {% for block in section.blocks %}
    {% assign collection = block.settings.collection %}
    {% assign label = block.settings.custom_name | strip %}
    {% assign image = block.settings.hover_image | image_url %}
    {% if collection %}
      <a
        href="{{ collection.url }}"
        class="collection-item"
        data-image-url="{{ image }}">
        {{ label | default: collection.title }}
      </a>
      {% if forloop.last == false %} &nbsp;•&nbsp; {% endif %}
    {% endif %}
  {% endfor %}
</div>

<div class="collection-image-preview" id="imagePreview">
  <img src="" alt="Vista previa">
</div>

{% javascript %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const items = document.querySelectorAll('.collection-item');
    const preview = document.getElementById('imagePreview');
    const img = preview.querySelector('img');

    items.forEach(item => {
      item.addEventListener('mouseenter', () => {
        const imageUrl = item.getAttribute('data-image-url');
        if (imageUrl) {
          img.src = imageUrl;
          preview.style.display = 'block';
        }
      });

      item.addEventListener('mousemove', (e) => {
        preview.style.top = `${e.pageY + 20}px`;
        preview.style.left = `${e.pageX}px`;
      });

      item.addEventListener('mouseleave', () => {
        preview.style.display = 'none';
        img.src = "";
      });
    });
  });
</script>
{% endjavascript %}
