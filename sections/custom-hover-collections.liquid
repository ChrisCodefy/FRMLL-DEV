{% schema %}
{
  "name": "Hover Collections",
  "settings": [
    {
      "type": "range",
      "id": "font_size",
      "label": "Tamaño del texto (vw)",
      "min": 1,
      "max": 8,
      "step": 0.1,
      "default": 3.5
    },
    {
      "type": "select",
      "id": "font_weight",
      "label": "Peso del texto",
      "default": "700",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medio" },
        { "value": "600", "label": "Semi Negrita" },
        { "value": "700", "label": "Negrita" },
        { "value": "800", "label": "Extra Negrita" }
      ]
    },
    {
      "type": "range",
      "id": "line_height",
      "label": "Altura de línea",
      "min": 1,
      "max": 2,
      "step": 0.1,
      "default": 1.2
    }
  ],
  "blocks": [
    {
      "type": "collection_item",
      "name": "Colección personalizada",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Seleccionar colección"
        },
        {
          "type": "text",
          "id": "custom_name",
          "label": "Nombre que se muestra",
          "default": "Mi colección"
        },
        {
          "type": "image_picker",
          "id": "hover_image",
          "label": "Imagen para hover (opcional)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Hover Collections Avanzado",
      "category": "Custom"
    }
  ]
}
{% endschema %}

{% stylesheet %}
<style>
  .collection-list {
    flex-wrap: wrap;
    display: flex;
    gap: 10px;
    position: relative;
    flex-direction: row;
    flex-wrap: wrap;
  }

  .collection-item {
    color: black;
    text-decoration: none;
    cursor: pointer;
    position: relative;
    white-space: nowrap;
  }

  .collection-item:hover {
    color: deeppink;
  }

  .collection-image-preview {
    position: absolute;
    display: none;
    z-index: 100;
    pointer-events: none;
  }

  .collection-image-preview img {
    max-width: 300px;
    border: 2px solid #000;
    background: white;
  }
</style>
{% endstylesheet %}

<div class="collection-list" style="
  font-size: {{ section.settings.font_size }}vw;
  font-weight: {{ section.settings.font_weight }};
  line-height: {{ section.settings.line_height }};
">
  {% for block in section.blocks %}
    {% assign collection = block.settings.collection %}
    {% assign label = block.settings.custom_name | strip %}
    {% assign hover_image = block.settings.hover_image %}
    {% if collection %}
      {% if hover_image %}
        {% assign image_url = hover_image | image_url %}
      {% elsif collection.featured_image %}
        {% assign image_url = collection.featured_image | image_url %}
      {% else %}
        {% assign image_url = "" %}
      {% endif %}

      <a
        href="{{ collection.url }}"
        class="collection-item"
        data-image-url="{{ image_url }}">
        {{ label | default: collection.title }}
      </a>
      {% if forloop.last == false %} &nbsp;•&nbsp; {% endif %}
    {% endif %}
  {% endfor %}
</div>

<div class="collection-image-preview" id="imagePreview">
  <img src="" alt="Vista previa">
</div>

{% javascript %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const items = document.querySelectorAll('.collection-item');
    const preview = document.getElementById('imagePreview');
    const img = preview.querySelector('img');

    items.forEach(item => {
      item.addEventListener('mouseenter', (e) => {
        const imageUrl = item.getAttribute('data-image-url');
        if (imageUrl) {
          img.src = imageUrl;
          preview.style.display = 'block';
        }
      });

      item.addEventListener('mousemove', (e) => {
        preview.style.top = `${e.pageY + 20}px`;
        preview.style.left = `${e.pageX}px`;
      });

      item.addEventListener('mouseleave', () => {
        preview.style.display = 'none';
        img.src = "";
      });
    });
  });
</script>
{% endjavascript %}
